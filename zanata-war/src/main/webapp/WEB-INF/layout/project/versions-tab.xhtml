<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:zanata="http://java.sun.com/jsf/composite/zanata"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:a4j="http://richfaces.org/a4j">

  <div class="panel">
    <div class="panel__header">
      <div class="panel__header__actions">
        <zanata:sortlist id="projects-project_sorting"
          sortAction="#{projectHomeAction.sortVersionList()}"
          render="versions_form"
          sortingList="#{projectHomeAction.versionSortingList}"/>

        <div
          class="dropdown dropdown--header dropdown--small dropdown--right dropdown--inline js-dropdown">
          <a class="dropdown__toggle js-dropdown__toggle" href="#"
            title=""
            data-original-title="#{messages['jsf.tooltip.MoreActions']}"><i
            class="i i--ellipsis"></i></a>
          <ul class="dropdown__content js-dropdown__content" role="content"
            aria-labelledby="dropdownContent">
            <s:fragment
              rendered="#{s:hasPermission(projectHome.instance, 'update')}">
              <li>
                <a
                  href="#{projectHomeAction.getCreateVersionUrl(projectHomeAction.slug)}">
                  #{messages['jsf.project.NewVersion']} <i
                  class="i i--plus i__item__icon"></i>
                </a>
              </li>
            </s:fragment>
          </ul>
        </div>
      </div>
      <h2 class="panel__heading">#{messages['jsf.Versions']}</h2>
    </div>
    <div class="panel__sub-header">
      <div class="panel__results">
        <div class="panel__results__type">
          <i class="i i--version txt--neutral"></i>
        </div>
        <span
          class="txt--meta"><strong>#{projectHomeAction.getProjectVersions().size}</strong></span>
      </div>
    </div>
    <h:form id="versions_form" styleClass="l--push-bottom-0">
      <ul class="list--stats">
        <ui:repeat value="#{projectHomeAction.getProjectVersions()}"
          var="versionItem">
          <li class="progress-bar__expander list__item--actionable">
            <div class="list__item__action">
              <div
                class="dropdown dropdown--small dropdown--inline dropdown--single list__item__dropdown js-dropdown">
                <a href="#"
                  class="dropdown__toggle js-dropdown__toggle txt--meta"
                  title=""
                  data-original-title="#{messages['jsf.tooltip.TranslateOptions']}">
                  <span class="is-invisible">
                    #{messages['jsf.tooltip.TranslateOptions']}
                  </span>
                </a>
                <s:fragment rendered="#{identity.loggedIn}">
                  <ul class="dropdown__content js-dropdown__content">
                    <ui:repeat
                      value="#{projectHomeAction.getSupportedLocale(versionItem.version)}"
                      var="hLocale">
                      <li>
                        <h:outputLink styleClass="i__item--right"
                          value="#{request.contextPath}/webtrans/Application.seam">
                          <f:param name="project"
                            value="#{projectHomeAction.slug}"/>
                          <f:param name="iteration"
                            value="#{versionItem.version.slug}"/>
                          <f:param name="localeId" value="#{hLocale.localeId}"/>
                          <f:param name="locale" value="#{locale.language}"/>
                          <span>
                            <s:fragment
                              rendered="#{projectHomeAction.isUserAllowedToTranslateOrReview(versionItem.version, hLocale)}">
                              <h:outputFormat
                                value="#{messages['jsf.project.TranslateIn']}">
                                <f:param
                                  value="#{hLocale.retrieveDisplayName()}"/>
                              </h:outputFormat> <i
                              class="i i--translate i__item__icon"></i>
                            </s:fragment>
                            <s:fragment
                              rendered="#{not projectHomeAction.isUserAllowedToTranslateOrReview(versionItem.version, hLocale)}">
                              <h:outputFormat
                                value="#{messages['jsf.project.ViewIn']}">
                                <f:param
                                  value="#{hLocale.retrieveDisplayName()}"/>
                              </h:outputFormat> <i
                              class="i i--translate i__item__icon"></i>
                            </s:fragment>
                          </span>
                        </h:outputLink>
                      </li>
                    </ui:repeat>
                    <li>
                      <h:outputLink id="exportTMXIterLink"
                        onclick="return confirm('#{messages['jsf.ConfirmExportTMXIter']}')"
                        styleClass="i__item--right"
                        value="#{request.contextPath}/rest/tm/projects/#{projectHomeAction.slug}/iterations/#{versionItem.version.slug}">
                        #{messages['jsf.iteration.ExportTMXIter']}<i
                        class="i i--export i__item__icon"></i>
                      </h:outputLink>
                    </li>
                  </ul>
                </s:fragment>
              </div>
            </div>

            <s:link view="/iteration/view.xhtml">
              <f:param name="projectSlug" value="#{projectHomeAction.slug}"/>
              <f:param name="iterationSlug"
                value="#{versionItem.version.slug}"/>

              <div class="list__item__content">
                <div class="list__item__info">
                  <h3 class="list__title">#{versionItem.version.slug}
                    <s:fragment rendered="#{versionItem.latestVersion}">
                      <span class="label--highlight">
                        #{messages['jsf.project.version.latest']}
                      </span>
                    </s:fragment>
                  </h3>
                </div>

                <s:div styleClass="list__item__stats"
                  rendered="#{projectHomeAction.pageRendered}">
                  <ui:param name="displayUnit"
                    value="#{projectHomeAction.getStatisticFigureForVersion(projectHomeAction.versionSortingList.selectedSortOption, versionItem.version.slug)}"/>
                   <span class="stats--small #{displayUnit.cssClass}">
                      <span class="stats__figure">
                        #{displayUnit.figure}
                      </span>
                      <span class="stats__unit txt--lowercase">
                        #{displayUnit.unit}
                      </span>
                    </span>
                </s:div>
              </div>
              <zanata:statistic
                value="#{projectHomeAction.getStatisticForVersion(versionItem.version.slug)}"
                rendered="#{projectHomeAction.pageRendered}"/>

              <a4j:status name="statistic-loader">
                <f:facet name="start">
                  <zanata:loader/>
                </f:facet>
              </a4j:status>
            </s:link>
          </li>
        </ui:repeat>
      </ul>
    </h:form>
  </div>
</ui:composition>