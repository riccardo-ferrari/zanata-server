<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:zanata="http://java.sun.com/jsf/composite/zanata"
  template="../WEB-INF/template/template.xhtml">

<ui:define name="page_title">
  #{messages['jsf.Version']} - #{versionHomeAction.projectSlug}:#{versionHomeAction.versionSlug}
</ui:define>

<ui:define name="center_content">
  <script type="text/javascript">
    jQuery(document).ready(function () {
      checkHashUrl('#languages_tab', '#settings-general_tab');
      renderStatistics();
    });

    function updateHashAndGotoUrl(anchor) {
      window.location.hash = jQuery(anchor).attr('href');
      checkHashUrl('#languages_tab', '#settings-general_tab');
    }
  </script>

  <h:form>
    <a4j:jsFunction name="refreshStatistics"
      render="overall_statistic, languages-language_form, languages-document_list, documents-document_form, documents-language_list, language-label, document-label"
      action="#{versionHomeAction.resetPageData}"/>

    <a4j:jsFunction name="renderStatistics"
      render="overall_statistic, languages-language_form, documents-document_form"
      action="#{versionHomeAction.setPageRendered(true)}"/>
  </h:form>

  <div class="g">
    <div class="g__item w--1-m w--3-8-l w--1-3 l--push-bottom-half">
      <p class="txt--meta l--push-all-0">
        <s:link view="/project/home.xhtml" propagation="none"
          value="#{messages['jsf.Projects']}"/>
        <i class="i i--arrow-right"></i>
        <s:link
          value="#{versionHomeAction.version.project.name}" propagation="none"
          view="/project/project.xhtml">
          <f:param name="slug" value="#{versionHomeAction.projectSlug}"/>
        </s:link>
      </p>

      <div class="l--push-bottom-half">
        <h1 class="l--push-all-0">
          <i class="i--small i--version txt--neutral i--left"></i>
          #{versionHomeAction.versionSlug}
        </h1>
      </div>

      <s:div styleClass="progress-bar--large__expander l--push-bottom-half"
        id="overall_statistic">
        <s:fragment rendered="#{versionHomeAction.pageRendered}">
          <p class="d--top l--pad-top-half txt--mini">
            #{messages['jsf.TotalSourceContains']}
            <strong>#{versionHomeAction.overallStatistic.total} words</strong>
          </p>
          <ul class="g g--fit">
            <li class="g__item">
              <span class="stats--large txt--state-success">
                <span class="stats__figure">
                  #{statisticBar.formatPercentage(versionHomeAction.overallStatistic.percentTranslated)}%
                </span>
                <span
                  class="stats__unit txt--lowercase"> #{messages['jsf.stats.Translated']}</span>
              </span>
            </li>
            <li class="g__item">
              <span class="stats--large">
                <span class="stats__figure">
                  #{statisticBar.formatHours(versionHomeAction.overallStatistic.remainingHours)}
                </span>
                <span class="stats__unit txt--lowercase">
                  #{messages['jsf.stats.TotalHoursRemaining']}
                </span>
              </span>
            </li>
          </ul>
          <zanata:statistic
            value="#{versionHomeAction.overallStatistic}"
            type="large"/>
        </s:fragment>

        <zanata:loader type="loader--large"
          rendered="#{!versionHomeAction.pageRendered}"/>
      </s:div>
    </div>

    <div class="g__item w--1-m w--5-8-l w--2-3">
      <div class="tabs--lined">
        <nav class="tabs__nav">
          <ul>
            <li>
              <a href="#languages" id="languages_tab" class="is-active js-tab">
                <i class="i i--language"></i>
                  <span class="is-hidden--s i__text--right">
                    #{messages['jsf.Languages']}
                    <s:span styleClass="txt--neutral" id="languages-size">
                      #{versionHomeAction.getSupportedLocale().size}
                    </s:span>
                  </span>
              </a>
            </li>
            <li>
              <a href="#documents" id="documents_tab" class="js-tab">
                <i class="i i--document"></i>
                  <span class="is-hidden--s i__text--right">
                    #{messages['jsf.Documents']}
                    <s:span styleClass="txt--neutral"
                      id="documents-size">
                      #{versionHomeAction.getDocuments().size}
                    </s:span>
                  </span>
              </a>
            </li>
            <li>
              <a href="#groups" id="groups_tab" class="js-tab">
                <i class="i i--group"></i>
                  <span class="is-hidden--s i__text--right">
                    #{messages['jsf.Groups']}
                    <s:span styleClass="txt--neutral" id="groups-size">
                      #{versionHomeAction.groups.size}
                    </s:span>
                  </span>
              </a>
            </li>
            <s:fragment
              rendered="#{s:hasPermission(versionHomeAction.version, 'update')}">
              <li class="tab__end">
                <div
                  class="dropdown dropdown--tab dropdown--small dropdown--right dropdown--inline js-dropdown">
                  <a class="dropdown__toggle js-dropdown__toggle" href="#">
                    <i class="i i--ellipsis"
                      data-original-title="#{messages['jsf.tooltip.MoreActions']}"></i>
                  </a>
                  <ul class="dropdown__content js-dropdown__content"
                    role="content" aria-labelledby="dropdownContent">
                    <li>
                      <h:outputLink id="exportTMXIterLink"
                        onclick="return confirm('#{messages['jsf.ConfirmExportTMXIter']}')"
                        styleClass="i__item--right"
                        value="#{request.contextPath}/rest/tm/projects/#{versionHomeAction.projectSlug}/iterations/#{versionHomeAction.versionSlug}">
                        #{messages['jsf.iteration.ExportTMXIter']}<i
                        class="i i--export i__item__icon"></i>
                      </h:outputLink>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="tab__end">
                <a href="#settings" id="settings_tab" class="js-tab"
                  data-original-title="#{messages['jsf.iteration.tooltip.VersionSettings']}">
                    <span class="is-hidden--m-down i__text--left">
                      #{messages['jsf.Settings']}
                    </span>
                  <i class="i i--settings"></i>
                </a>
              </li>
            </s:fragment>
          </ul>
        </nav>

        <div class="tabs__content panels__container l--push-top-1">
          <div id="languages_content" class="is-hidden">
            <ui:include
              src="../WEB-INF/layout/version/languages-tab.xhtml"/>
          </div>

          <div id="documents_content" class="is-hidden">
            <ui:include
              src="../WEB-INF/layout/version/documents-tab.xhtml"/>
          </div>

          <div id="groups_content" class="is-hidden">
            <ui:include
              src="../WEB-INF/layout/version/groups-tab.xhtml"/>
          </div>

          <s:fragment
            rendered="#{s:hasPermission(versionHomeAction.version, 'update')}">
            <div id="settings_content" class="is-hidden">
              <ui:include
                src="../WEB-INF/layout/version/settings-tab.xhtml"/>
            </div>
          </s:fragment>
        </div>

      </div>
    </div>
  </div>
</ui:define>

</ui:composition>